{% if session.user_id %}
<font size="+1">Olet kirjautunut sisään käyttäjällä {{ session.username }} </font>
<a href="/new">Luo uusi viesti</a> 
{% if admin == True %}
<font size="+1">|</font> <a href="/new_private">Luo uusi yksityinen viesti</a> 
{% endif %}
<font size="+1">|</font> 
<a href="/logout">Kirjaudu ulos</a>
{% else %}
<a href="/login">Kirjaudu sisään</a> | <a href="/register">Luo uusi tunnus</a>
{% endif %}
<hr>
<font size="+1">Hae viestejä:</font><p>
<form action="/result" method="GET" onsubmit="return check(this)">
Hakusana: <input type="text" name="query">
<input type="submit" value="Hae">
</form>

<script>
    function check(form) {
        if (form.query.value.length > 100) {
            alert("Hakusana on liian pitkä");
            return false;
        }
        return true;
    }
    </script>

<a href="/favorites">Mene suosikkeihisi</a>
<hr>
{% for message in messages %}
{% if message[8] == True and admin == False%}
{% else %}
    <font size="+2">Aihe: {{ message[1] }}</font>
    {% if message[8] == True%}
     (Yksityinen)
    {% endif %}
    {% if session.user_id %}
        {% set is_favorite = message[0] in favorites %}
            {% if is_favorite %}
                <form action="/remove_favorite" method="POST">
                    <input type="hidden" name="message_id" value="{{ message[0] }}">
                    <input type="hidden" name="user_id" value="{{ session.user_id }}">
                    <input type="hidden" name="source" value="/">
                    <input type="submit" value="Poista suosikeista">
                </form>
            {% else %}
                <form action="/add_favorite" method="POST">
                    <input type="hidden" name="message_id" value="{{ message[0] }}">
                    <input type="hidden" name="user_id" value="{{ session.user_id }}">
                    <input type="submit" value="Lisää suosikkeihin">
                </form>
            {% endif %}
    {% endif %}
    <p>
    <i>Viesti:</i> {{ message[2] }}
    <p>
    <i>Lähettäjä:</i> {{ message[4] }}
    <p>
    <i>Aika:</i> {{ message[5].strftime("%H:%M %d-%m-%Y") }}
    {% if message[7] == True %}
    (Muokattu)
    {% endif %}
    <p>
    <a href="/message/{{ message[0] }}">Mene viestiin</a> Vastauksia: {{ message[6] }}<br>
        {% if message[3] == session.user_id %}
        <p>
        <form action="/edit_message/{{ message[0] }}?user_id={{ message[3] }}" method="GET">
            <input type="hidden" name="message_id" value="{{ message[0] }}">
            <input type="submit" value="Muokkaa viestiä">
        </form>
        {% endif %} 
        {% if message[3] == session.user_id or admin == True %}
        <p>
        <form action="/delete_message" method="POST">
            <input type="hidden" name="user_id" value="{{ message[3] }}">
            <input type="hidden" name="message_id" value="{{ message[0] }}">
            <input type="submit" value="Poista viesti">
        </form>    
        {% endif %}
    <hr>
{% endif %}
{% endfor %}